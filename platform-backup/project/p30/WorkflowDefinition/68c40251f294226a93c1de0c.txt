{
	"createdTime":1759994537611,
	"deleted":false,
	"description":"Cancel/Resume Workflows stuck for more than a configured time period",
	"edges":[
		{
			"fromNodeId":"n_SlEpw",
			"priority":0,
			"skip":false,
			"toNodeId":"n_w8VfF",
			"type":"next"
		},
		{
			"fromNodeId":"n_w8VfF",
			"priority":0,
			"skip":false,
			"toNodeId":"n_NCf7z",
			"type":"next"
		},
		{
			"fromNodeId":"n_NCf7z",
			"priority":0,
			"skip":false,
			"toNodeId":"_nD6JX",
			"type":"next"
		},
		{
			"fromNodeId":"_nD6JX",
			"priority":0,
			"skip":false,
			"toNodeId":"_s9ojw",
			"type":"loop"
		},
		{
			"fromNodeId":"_s9ojw",
			"priority":0,
			"skip":false,
			"toNodeId":"n_Fu0BR",
			"type":"next"
		},
		{
			"fromNodeId":"n_Fu0BR",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"_9Camc",
			"type":"if"
		},
		{
			"fromNodeId":"_9Camc",
			"priority":0,
			"skip":false,
			"toNodeId":"n_2qis7",
			"type":"next"
		},
		{
			"fromNodeId":"n_Fu0BR",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"n_2qis7",
			"type":"next"
		},
		{
			"fromNodeId":"n_2qis7",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"n_u2sM5",
			"type":"if"
		},
		{
			"fromNodeId":"n_u2sM5",
			"priority":0,
			"skip":false,
			"toNodeId":"n_d7IHj",
			"type":"next"
		},
		{
			"fromNodeId":"n_2qis7",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"n_d7IHj",
			"type":"next"
		},
		{
			"fromNodeId":"n_d7IHj",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"n_Tlw7N",
			"type":"if"
		},
		{
			"fromNodeId":"n_Tlw7N",
			"name":"loopback",
			"priority":0,
			"skip":false,
			"toNodeId":"_nD6JX",
			"type":"next"
		},
		{
			"fromNodeId":"n_d7IHj",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"_nD6JX",
			"type":"next"
		},
		{
			"fromNodeId":"_nD6JX",
			"priority":0,
			"skip":false,
			"toNodeId":"n_LP1uE",
			"type":"next"
		}
	],
	"id":"68c40251f294226a93c1de0c",
	"lastModifiedBy":1,
	"lcName":"workflow execution | cleanup job (from redis)",
	"modifiedTime":1759994537611,
	"name":"Workflow Execution | Cleanup Job (From Redis)",
	"nodes":[
		{
			"context":{
				"appName":"schedule",
				"resourceVersion":0,
				"resourceName":"schedule_default"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_IiZN3-1",
			"id":"n_SlEpw",
			"index":1,
			"inputs":{
				"cron":"EXPRESSION",
				"expression":"0 0 * * *",
				"sequential":false,
				"timezone":"Asia/Calcutta",
				"interval":15,
				"frequency":"MINUTES"
			},
			"skip":false,
			"subTitle":"Schedule",
			"title":"New recurring event",
			"trigger":{
				"type":"SCHEDULED"
			},
			"type":"START"
		},
		{
			"additional":{
				"xsdSchemaConfig":{
					"root":{}
				},
				"visibleOptionalFields":[
					"root.parameters.buffer.days",
					"root.parameters.buffer.hours",
					"root.parameters.buffer.minutes"
				]
			},
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":0,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_IiZN3-1",
			"id":"n_w8VfF",
			"index":2,
			"inputs":{
				"output":{
					"type":"object",
					"additionalProperties":false,
					"required":[
						"bufferedEpoch"
					],
					"properties":{
						"bufferedEpoch":{
							"type":"integer",
							"title":"Buffered Epoch"
						}
					}
				},
				"input":{
					"type":"object",
					"additionalProperties":false,
					"properties":{
						"buffer":{
							"type":"object",
							"properties":{
								"days":{
									"type":"integer",
									"title":"days"
								},
								"hours":{
									"type":"integer",
									"title":"hours"
								},
								"minutes":{
									"type":"integer",
									"title":"minutes"
								}
							},
							"title":"buffer",
							"additionalProperties":false,
							"required":[]
						}
					}
				},
				"code":"def buffer = binding.getVariable(\"buffer\") ?: [:];\n\ndef days = buffer?.days ? buffer.days : 0;\ndef hours = (days * 24) + (buffer?.hours ? buffer.hours : 0);\ndef minutes = (hours * 60) + (buffer?.minutes ? buffer.minutes : 0);\n\ndef now = System.currentTimeMillis();\n\ndef before = now - (minutes * 60 * 1000);\n\nreturn [\n    bufferedEpoch: before\n]",
				"compile_static":false,
				"captureStdOutput":false,
				"parameters":{
					"buffer":{
						"days":1,
						"hours":0,
						"minutes":0
					}
				}
			},
			"skip":false,
			"subTitle":"Code",
			"title":"Calculate Epochs",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"variable_by_unifyapps",
				"resourceVersion":0,
				"resourceName":"variable_by_unifyapps_create_variables",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_IiZN3-1",
			"id":"n_NCf7z",
			"index":3,
			"inputSchema":{
				"type":"SCHEMA_AND_LAYOUT",
				"dynamic":false,
				"layout":{},
				"schema":{
					"additionalProperties":false,
					"type":"object",
					"properties":{
						"cancelPayload":{
							"type":"object",
							"properties":{
								"reason":{
									"type":"string",
									"title":"Reason"
								}
							},
							"additionalProperties":false,
							"title":"Cancel Payload",
							"description":"Payload with which to cancel the run.",
							"required":[
								"reason"
							]
						},
						"bufferedEpoch":{
							"type":"integer",
							"title":"Buffered Epoch",
							"description":"Buffer on the start time. Only the runs triggered before \"bufferEpoch\" duration are processed."
						},
						"resumeWorkflow":{
							"type":"boolean",
							"title":"Resume Workflow",
							"description":"Enable the flag to resume DEFAULT runs. All runs are cancelled if the flag is disabled."
						}
					},
					"required":[
						"cancelPayload",
						"bufferedEpoch",
						"resumeWorkflow"
					]
				}
			},
			"inputs":{
				"bufferedEpoch":"{{ n_w8VfF.outputs.result.bufferedEpoch }}",
				"cancelPayload":{
					"reason":"Bulk cancelled Waiting runs via automation ID: {{ __RUN__.outputs.workflowId }}"
				},
				"resumeWorkflow":false
			},
			"outputSchema":{
				"dynamic":false,
				"schema":{
					"additionalProperties":false,
					"type":"object",
					"properties":{
						"cancelPayload":{
							"type":"object",
							"properties":{
								"reason":{
									"type":"string",
									"title":"Reason"
								}
							},
							"additionalProperties":false,
							"title":"Cancel Payload",
							"description":"Payload with which to cancel the run.",
							"required":[
								"reason"
							]
						},
						"bufferedEpoch":{
							"type":"integer",
							"title":"Buffered Epoch",
							"description":"Buffer on the start time. Only the runs triggered before \"bufferEpoch\" duration are processed."
						},
						"resumeWorkflow":{
							"type":"boolean",
							"title":"Resume Workflow",
							"description":"Enable the flag to resume DEFAULT runs. All runs are cancelled if the flag is disabled."
						}
					},
					"required":[
						"cancelPayload",
						"bufferedEpoch",
						"resumeWorkflow"
					]
				}
			},
			"skip":false,
			"subTitle":"Variable",
			"title":"Control Params",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"standard_entities",
				"resourceVersion":2,
				"resourceName":"standard_entities_fetch_ongoing_workflow_runs",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_IiZN3-1",
			"id":"_nD6JX",
			"index":4,
			"inputs":{
				"captureIterations":false,
				"batchSize":1000
			},
			"skip":false,
			"subTitle":"Standard entities by UnifyApps",
			"title":"Fetch Ongoing Workflow Runs",
			"type":"LOOP"
		},
		{
			"additional":{
				"xsdSchemaConfig":{
					"root":{}
				}
			},
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":0,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_nD6JX@_IiZN3-1@l",
			"id":"_s9ojw",
			"index":5,
			"inputs":{
				"output":{
					"type":"object",
					"additionalProperties":false,
					"properties":{
						"ongoingRuns":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{
									"deployedWorkflowId":{
										"type":"string",
										"title":"deployedWorkflowId"
									},
									"deployedWorkflowVersion":{
										"type":"string",
										"title":"deployedWorkflowVersion"
									},
									"executionId":{
										"type":"string",
										"title":"executionId"
									},
									"executionStatus":{
										"type":"string",
										"title":"executionStatus"
									},
									"startTime":{
										"type":"integer",
										"title":"startTime"
									},
									"workflowId":{
										"type":"string",
										"title":"workflowId"
									}
								},
								"additionalProperties":false
							},
							"title":"ongoingRuns"
						},
						"ongoingRunsCount":{
							"type":"integer",
							"title":"ongoingRunsCount"
						},
						"completedRuns":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{
									"deployedWorkflowId":{
										"type":"string",
										"title":"deployedWorkflowId"
									},
									"deployedWorkflowVersion":{
										"type":"string",
										"title":"deployedWorkflowVersion"
									},
									"executionId":{
										"type":"string",
										"title":"executionId"
									},
									"executionStatus":{
										"type":"string",
										"title":"executionStatus"
									},
									"startTime":{
										"type":"integer",
										"title":"startTime"
									},
									"workflowId":{
										"type":"string",
										"title":"workflowId"
									}
								},
								"additionalProperties":false
							},
							"title":"completedRuns"
						},
						"completedRunsCount":{
							"type":"integer",
							"title":"completedRunsCount"
						},
						"corruptedRuns":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{
									"deployedWorkflowId":{
										"type":"string",
										"title":"deployedWorkflowId"
									},
									"deployedWorkflowVersion":{
										"type":"string",
										"title":"deployedWorkflowVersion"
									},
									"executionId":{
										"type":"string",
										"title":"executionId"
									},
									"executionStatus":{
										"type":"string",
										"title":"executionStatus"
									},
									"startTime":{
										"type":"integer",
										"title":"startTime"
									},
									"workflowId":{
										"type":"string",
										"title":"workflowId"
									}
								},
								"additionalProperties":false
							},
							"title":"corruptedRuns"
						},
						"corruptedRunsCount":{
							"type":"integer",
							"title":"corruptedRunsCount"
						}
					}
				},
				"input":{
					"type":"object",
					"additionalProperties":false,
					"required":[
						"runs",
						"bufferedEpoch"
					],
					"properties":{
						"runs":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{},
								"additionalProperties":false
							},
							"title":"Runs"
						},
						"bufferedEpoch":{
							"type":"integer",
							"title":"Buffered Epoch"
						}
					}
				},
				"code":"def runs = binding.hasVariable(\"runs\") ? runs : [];\ndef startEpoch = bufferedEpoch; // must fail incase bufferedEpoch is absent\n\ndef ongoingRuns = []; // status is ACTIVE or WAITING\ndef completedRuns = []; // status is COMPLETED, FAILED, or CANCELLED\ndef corruptedRuns = []; // any other status\n\nruns.stream().filter(run -> run.startTime != null && run.startTime < startEpoch).forEach(run -> {\n  switch (run.executionStatus) {\n    case \"ACTIVE\", \"WAIT\" -> ongoingRuns.add(run);\n    case \"COMPLETED\", \"CANCELLED\", \"FAILED\" -> completedRuns.add(run);\n    default -> corruptedRuns.add(run);\n  }\n});\n\nreturn [\n  \"ongoingRuns\": ongoingRuns,\n  \"ongoingRunsCount\": ongoingRuns.size(),\n  \"completedRuns\": completedRuns,\n  \"completedRunsCount\": completedRuns.size(),\n  \"corruptedRuns\": corruptedRuns,\n  \"corruptedRunsCount\": corruptedRuns.size(),\n]",
				"compile_static":false,
				"captureStdOutput":false,
				"parameters":{
					"bufferedEpoch":"{{ n_NCf7z.outputs.bufferedEpoch }}",
					"runs":{
						"source":"{{ _nD6JX.outputs.item }}",
						"ua:type":"mappedArray",
						"items":"{{ _nD6JX.outputs.item[0] }}"
					}
				}
			},
			"skip":false,
			"subTitle":"Code by UnifyApps",
			"title":"Filter Runs by StartTime",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":0,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_nD6JX@_IiZN3-1@l",
			"id":"n_Fu0BR",
			"index":6,
			"inputs":{
				"filters":[
					{
						"property":"{{ _s9ojw.outputs.result.ongoingRunsCount }}",
						"filter":{
							"operator":"GT",
							"value":"0"
						}
					}
				],
				"operator":"AND"
			},
			"skip":false,
			"subTitle":"Ongoing Runs Exist",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"additional":{
				"visibleOptionalFields":[
					"root.parameters.resumeWorkflow"
				]
			},
			"context":{
				"appName":"callables",
				"resourceVersion":2,
				"resourceName":"callables_call_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"n_Fu0BR@_nD6JX@_IiZN3-1@l@y",
			"id":"_9Camc",
			"index":7,
			"inputs":{
				"automationId":"68c5336faefb97481a1fe7c1",
				"runtimeConnections":{},
				"synchronous":false,
				"triggerWorkflowWithRuntimeType":"IN_MEMORY",
				"version":"-1",
				"parameters":{
					"cancelPayload":"{{ n_NCf7z.outputs.cancelPayload }}",
					"resumeWorkflow":"{{ n_NCf7z.outputs.resumeWorkflow }}",
					"runDetails":{
						"ua:type":"mappedArray",
						"items":{
							"runtimeType":"DEFAULT",
							"executionId":"{{ _s9ojw.outputs.result.ongoingRuns[0].executionId }}",
							"workflowId":"{{ _s9ojw.outputs.result.ongoingRuns[0].workflowId }}"
						},
						"source":"{{ _s9ojw.outputs.result.ongoingRuns }}"
					}
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Process ongoing runs",
			"type":"CALL_WORKFLOW"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":0,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_nD6JX@_IiZN3-1@l",
			"id":"n_2qis7",
			"index":8,
			"inputs":{
				"filters":[
					{
						"property":"{{ _s9ojw.outputs.result.completedRunsCount }}",
						"filter":{
							"operator":"GT",
							"value":"0"
						}
					}
				],
				"operator":"AND"
			},
			"skip":false,
			"subTitle":"Completed Runs Exist",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":2,
				"resourceName":"callables_call_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"n_2qis7@_nD6JX@_IiZN3-1@l@y",
			"id":"n_u2sM5",
			"index":9,
			"inputs":{
				"automationId":"68c7cf3cfb1b4909a95d45ca",
				"runtimeConnections":{},
				"synchronous":false,
				"triggerWorkflowWithRuntimeType":"IN_MEMORY",
				"version":"-1",
				"parameters":{
					"runDetails":{
						"source":"{{ _s9ojw.outputs.result.completedRuns }}",
						"ua:type":"mappedArray",
						"items":{
							"workflowId":"{{ _s9ojw.outputs.result.completedRuns[0].workflowId }}",
							"executionId":"{{ _s9ojw.outputs.result.completedRuns[0].executionId }}"
						}
					}
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Call automation",
			"type":"CALL_WORKFLOW"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":0,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_nD6JX@_IiZN3-1@l",
			"id":"n_d7IHj",
			"index":10,
			"inputs":{
				"filters":[
					{
						"property":"{{ _s9ojw.outputs.result.corruptedRunsCount }}",
						"filter":{
							"operator":"GT",
							"value":"0"
						}
					}
				],
				"operator":"AND"
			},
			"skip":false,
			"subTitle":"Corrupted Runs Exist",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"additional":{
				"visibleOptionalFields":[
					"root.records.items.deployedWorkflowId",
					"root.records.items.deployedWorkflowVersion",
					"root.records.items.executionId",
					"root.records.items.executionStatus",
					"root.records.items.startTime",
					"root.records.items.workflowId"
				]
			},
			"context":{
				"appName":"storage_by_unifyapps",
				"resourceVersion":45,
				"resourceName":"storage_by_unifyapps_bulk_create_records",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"n_d7IHj@_nD6JX@_IiZN3-1@l@y",
			"id":"n_Tlw7N",
			"index":11,
			"inputs":{
				"object_type":"corrupted_run_in_redis",
				"skipIfBlank":false,
				"records":{
					"source":"{{ _s9ojw.outputs.result.corruptedRuns }}",
					"ua:type":"mappedArray",
					"items":{
						"deployedWorkflowId":"{{ _s9ojw.outputs.result.corruptedRuns[0].deployedWorkflowId }}",
						"deployedWorkflowVersion":"{{ _s9ojw.outputs.result.corruptedRuns[0].deployedWorkflowVersion }}",
						"executionId":"{{ _s9ojw.outputs.result.corruptedRuns[0].executionId }}",
						"executionStatus":"{{ _s9ojw.outputs.result.corruptedRuns[0].executionStatus }}",
						"startTime":"{{ _s9ojw.outputs.result.corruptedRuns[0].startTime }}",
						"workflowId":"{{ _s9ojw.outputs.result.corruptedRuns[0].workflowId }}"
					}
				}
			},
			"skip":false,
			"subTitle":"Storage by UnifyApps",
			"title":"Create or update records in bulk",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"stop"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_IiZN3-1",
			"id":"n_LP1uE",
			"index":12,
			"skip":false,
			"subTitle":"Stop",
			"title":"Stop",
			"type":"STOP"
		}
	],
	"ownerUserId":1,
	"projectId":30,
	"schemaReferences":[
		
	],
	"settings":{
		"enableNodeLevelLogging":true,
		"enableRunLogging":true,
		"enableVariableLogging":true,
		"route":{
			"default":false,
			"tierName":"global"
		}
	},
	"standard":false,
	"tags":[
		"cleanup",
		"redis"
	],
	"version":35
}