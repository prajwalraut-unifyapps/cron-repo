{
	"appsUsed":[
		
	],
	"createdTime":1740599065215,
	"deleted":false,
	"deploymentState":{
		"deployedAt":1757441838596,
		"deployedBy":0,
		"deployedDefinitionId":"68c06f2e91dbf0016b7688e6",
		"status":"DEPLOYED",
		"version":54,
		"workflowVersion":78
	},
	"edges":[
		{
			"fromNodeId":"DBzLs",
			"priority":0,
			"skip":false,
			"toNodeId":"w508p",
			"type":"next"
		},
		{
			"fromNodeId":"w508p",
			"priority":0,
			"skip":false,
			"toNodeId":"iXfrU",
			"type":"next"
		}
	],
	"grants":{
		"configs":[
			{
				"permissions":[
					"V"
				],
				"principalType":"GLOBAL"
			}
		]
	},
	"id":"67bdeaa2ba32d908560a258c",
	"lastModifiedBy":-1,
	"lcName":"generate citations from reference",
	"modifiedTime":1758530308411,
	"name":"Generate Citations from Reference",
	"nodes":[
		{
			"context":{
				"appName":"callables",
				"resourceVersion":78,
				"resourceName":"callables_from_automation"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"mJR3b-1",
			"id":"DBzLs",
			"index":0,
			"inputs":{
				"result":{
					"type":"object",
					"properties":{
						"citationBlock":{
							"type":"object",
							"properties":{},
							"additionalProperties":false,
							"title":"Citation Block"
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"setup":{
					"type":"object",
					"properties":{
						"chunkMetadata":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{},
								"additionalProperties":false,
								"required":[]
							},
							"title":"Chunk Metadata"
						}
					},
					"additionalProperties":false,
					"required":[]
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Trigger via automation",
			"trigger":{
				"type":"CALLABLE"
			},
			"type":"START"
		},
		{
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":78,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"mJR3b-1",
			"id":"w508p",
			"index":0,
			"inputs":{
				"output":{
					"type":"object",
					"properties":{
						"citationBlock":{
							"type":"object",
							"properties":{
								"blockType":{
									"type":"string",
									"title":"blockType"
								},
								"data":{
									"type":"array",
									"items":{
										"type":"object",
										"properties":{},
										"additionalProperties":false
									},
									"title":"data"
								}
							},
							"additionalProperties":false,
							"title":"Citation Block",
							"required":[]
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"input":{
					"type":"object",
					"properties":{
						"chunkMetadata":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{},
								"additionalProperties":false,
								"required":[]
							},
							"title":"Chunk Metadata"
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"compile_static":true,
				"code":"static Map<String, Object> safeMap(Object obj) {\n    return (obj instanceof Map) ? (Map<String, Object>) obj : Collections.emptyMap()\n}\n\nstatic List<Map<String, Object>> getCitations(List<Object> rawChunkMetadata) {\n    List<Map<String, Object>> citations = []\n    Set<Object> seenEntityIds = new HashSet<>()\n\n    for (Object item : rawChunkMetadata) {\n        Map<String, Object> chunk = safeMap(item)\n        Map<String, Object> citation = [:]\n\n        Object uniqueEntityId = chunk[\"uniqueEntityId\"]\n        if (uniqueEntityId != null) {\n            if (seenEntityIds.contains(uniqueEntityId)) {\n                continue\n            }\n            seenEntityIds.add(uniqueEntityId)\n        }\n\n        if (chunk[\"channelName\"] != null) {\n            citation = [\n                appName             : \"slack\",\n                referenceUrl        : chunk[\"referenceUrl\"],\n                knowledgeSourceType : \"APPLICATION\",\n                title               : chunk[\"channelName\"]\n            ]\n        } else if (chunk[\"websiteUrl\"] != null) {\n            citation = [\n                referenceUrl        : chunk[\"websiteUrl\"],\n                knowledgeSourceType : \"WEBSITE\",\n                title               : chunk[\"title\"]\n            ]\n        } else if (chunk[\"webViewUrl\"] != null) {\n            citation = [\n                referenceUrl        : chunk[\"webViewUrl\"],\n                knowledgeSourceType : \"APPLICATION\",\n                appName             : \"gdrive\"\n            ]\n        } else if (chunk[\"appName\"] != null) {\n            citation = [\n                knowledgeSourceType : \"APPLICATION\",\n                referenceUrl        : chunk[\"referenceUrl\"],\n                name                : chunk[\"name\"],\n                appName             : chunk[\"appName\"]\n            ]\n        } else if (chunk[\"kind\"] != null) {\n            citation = [\n                knowledgeSourceType : \"APPLICATION\",\n                referenceUrl        : chunk[\"referenceUrl\"],\n                name                : chunk[\"name\"],\n                appName             : \"gdrive\"\n            ]\n        } else {\n            citation = [\n                knowledgeSourceType : \"FILE\",\n                referenceUrl        : chunk[\"referenceUrl\"],\n                name                : chunk[\"name\"],\n                source              : chunk[\"source\"]\n            ]\n        }\n\n        citation[\"iconUrl\"] = chunk[\"iconUrl\"]\n        citation[\"chunkContents\"] = chunk[\"chunkContents\"]\n        citation[\"chunkDetails\"] = chunk[\"chunkDetails\"]\n        citation[\"id\"] = chunk[\"id\"]\n        citation[\"author\"] = chunk[\"author\"]\n        citation[\"date\"] = chunk[\"date\"]\n\n        if (chunk[\"chunkDetails\"] != null) {\n            citation[\"chunkDetails\"] = chunk[\"chunkDetails\"]\n        } else {\n            List<Map<String, Object>> chunkDetails = [[chunkId: chunk[\"chunkId\"]]]\n            citation[\"chunkDetails\"] = chunkDetails\n        }\n\n        citations.add(citation)\n    }\n\n    return citations\n}\n\nList<Object> chunkMetadata = binding.hasVariable(\"chunkMetadata\") ? (List<Object>) binding.getVariable(\"chunkMetadata\") : []\n\nList<Map<String, Object>> citations = chunkMetadata != null ? getCitations(chunkMetadata) : []\n\nMap<String, Object> citationBlock = [\n    blockType: \"Citation\",\n    data     : [\n        citations: citations\n    ]\n]\n\nreturn [\n    citationBlock: citationBlock\n]\n",
				"parameters":{
					"chunkMetadata":{
						"source":"{{ DBzLs.outputs.chunkMetadata }}",
						"ua:type":"mappedArray",
						"items":"{{ DBzLs.outputs.chunkMetadata[0] }}"
					}
				}
			},
			"skip":false,
			"subTitle":"Code by UnifyApps",
			"title":"Execute Groovy code",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":80,
				"resourceName":"callables_return_to_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"mJR3b-1",
			"id":"iXfrU",
			"index":0,
			"inputs":{
				"result":{
					"citationBlock":"{{ w508p.outputs.result.citationBlock }}"
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Respond to automation",
			"type":"STOP"
		}
	],
	"ownerUserId":1866,
	"schemaReferences":[
		
	],
	"settings":{
		"enableNodeLevelLogging":true,
		"enableRunLogging":true,
		"enableVariableLogging":true,
		"route":{
			"default":false,
			"tierName":"global"
		}
	},
	"standard":true,
	"tags":[
		"AI Agent"
	],
	"version":80
}