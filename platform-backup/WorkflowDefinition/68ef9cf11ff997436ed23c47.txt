{
	"appsUsed":[
		
	],
	"createdTime":1760533745463,
	"deleted":false,
	"edges":[
		{
			"fromNodeId":"n_Kt8cu",
			"priority":0,
			"skip":false,
			"toNodeId":"n_hjAVF",
			"type":"next"
		},
		{
			"fromNodeId":"n_hjAVF",
			"priority":0,
			"skip":false,
			"toNodeId":"n_fjulZ",
			"type":"next"
		},
		{
			"fromNodeId":"n_fjulZ",
			"priority":0,
			"skip":false,
			"toNodeId":"n_3sJHN",
			"type":"next"
		}
	],
	"id":"68ef9cf11ff997436ed23c47",
	"lastModifiedBy":39713,
	"lcName":"testmongointapi",
	"modifiedTime":1760543594248,
	"name":"testMongoIntAPI",
	"nodes":[
		{
			"context":{
				"appName":"webhooks",
				"resourceVersion":833,
				"resourceName":"webhooks_default"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_65xO5-1",
			"id":"n_Kt8cu",
			"index":1,
			"inputs":{
				"request":{
					"contentType":"application/json"
				}
			},
			"skip":false,
			"subTitle":"Webhook",
			"title":"New event",
			"trigger":{
				"type":"WEBHOOK"
			},
			"type":"START"
		},
		{
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":1003,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_65xO5-1",
			"id":"n_hjAVF",
			"index":2,
			"inputs":{
				"code":"\nimport io.quarkus.arc.Arc;\nimport com.unifyapps.infra.mongo.MongoTemplateFactory;\nimport com.unifyapps.infra.mongo.MongoTemplate;\nimport org.bson.Document;\nimport com.mongodb.client.MongoCollection;\nimport com.mongodb.client.model.UpdateOptions;\nimport com.mongodb.client.result.UpdateResult;\nimport org.bson.conversions.Bson;\n\nlong customerId = 1L;\nString resourceType = \"Workflow\";\nString collectionName = \"DeployedWorkflowDefinition\";\ndef mongoTemplateFactory = Arc.container().instance(MongoTemplateFactory.class).get();\nMongoTemplate mongoTemplate = mongoTemplateFactory.getMongoTemplate(customerId, { -> resourceType });\nMongoCollection<Document> collection = mongoTemplate.getCollection(collectionName);\nDocument filter = new Document(\"nodes.context.appName\", \"storage_by_unifyapps\");\nDocument update = new Document(\"\\$set\", \n    new Document(\"nodes.\\$[elem].inputs.Unset if Null\", true)\n);\nList<Bson> arrayFilters = [\n    new Document(\"elem.context.appName\", \"storage_by_unifyapps\")\n];\nUpdateOptions options = new UpdateOptions().arrayFilters(arrayFilters);\nUpdateResult result = collection.updateMany(filter, update, options);\nreturn result.getModifiedCount();",
				"compile_static":false,
				"captureStdOutput":false
			},
			"skip":true,
			"subTitle":"Code by UnifyApps",
			"title":"Execute Groovy code",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":1003,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_65xO5-1",
			"id":"n_fjulZ",
			"index":3,
			"inputs":{
				"code":"\nimport io.quarkus.arc.Arc;\nimport com.unifyapps.infra.mongo.MongoTemplateFactory;\nimport com.unifyapps.infra.mongo.MongoTemplate;\nimport org.bson.Document;\nimport com.mongodb.client.MongoCollection;\nimport com.mongodb.client.model.UpdateOptions;\nimport com.mongodb.client.result.UpdateResult;\nimport org.bson.conversions.Bson;\n\n\nlong customerId = 1L;\nString resourceType = \"Workflow\";\nString collectionName = \"DeployedWorkflowDefinition\";\n\n\ndef mongoTemplateFactory = Arc.container().instance(MongoTemplateFactory.class).get();\nMongoTemplate mongoTemplate = mongoTemplateFactory.getMongoTemplate(customerId, { -> resourceType });\nMongoCollection<Document> collection = mongoTemplate.getDatabase().getCollection(collectionName);\nDocument filter = new Document(\"name\", \"TestMongoAPICurl\")\n    .append(\"nodes.context.appName\", \"storage_by_unifyapps\");\n\nDocument update = new Document(\"\\$set\", \n    new Document(\"nodes.\\$[elem].inputs.unsetIfNull\", true)\n);\nList<Bson> arrayFilters = [\n    new Document(\"elem.context.appName\", \"storage_by_unifyapps\")\n];\nUpdateOptions options = new UpdateOptions().arrayFilters(arrayFilters);\nUpdateResult result = collection.updateOne(filter, update, options);\nreturn result.getModifiedCount();",
				"compile_static":false,
				"captureStdOutput":false
			},
			"skip":false,
			"subTitle":"Code by UnifyApps",
			"title":"Execute Groovy code",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":1003,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":true,
			"fallbackMode":"STOP",
			"groupId":"_65xO5-1",
			"id":"n_3sJHN",
			"index":4,
			"inputs":{
				"code":"// Imports for both the UnifyApps framework and the raw MongoDB driver\nimport io.quarkus.arc.Arc;\nimport com.unifyapps.infra.mongo.MongoTemplateFactory;\nimport com.unifyapps.infra.mongo.MongoTemplate;\nimport com.mongodb.client.MongoClient;\nimport com.mongodb.client.MongoDatabase;\nimport com.mongodb.client.MongoCollection;\nimport org.bson.Document;\nimport java.util.ArrayList;\nimport java.util.List;\n\n// 1. Define the context for the query\nlong customerId = 1L;\nString resourceType = \"Workflow\";\nString collectionName = \"DeployedWorkflowDefinition\";\n\n// 2. Inject the MongoTemplateFactory to get configured components\ndef mongoTemplateFactory = Arc.container().instance(MongoTemplateFactory.class).get();\nMongoTemplate mongoTemplate = mongoTemplateFactory.getMongoTemplate(customerId, { -> resourceType });\n\n// --- RAW MONGO CLIENT APPROACH ---\n\n// 3. Discover the correct database name and get the raw client from the template\nString databaseName = mongoTemplate.getDatabase().getName();\nMongoClient mongoClient = mongoTemplate.getMongoClient();\n\nprintln(\"Attempting to connect to database: \" + databaseName);\n// 4. Manually get the database and collection using the raw client\nMongoDatabase database = mongoClient.getDatabase(\"CUSTOMER_WORKFLOW_1\");\nMongoCollection<Document> collection = database.getCollection(collectionName);\n// return collection.getNamespace();\n// return collection.countDocuments();\n// 5. Perform a raw find().limit(5) operation on the collection\nList<Document> documents = collection.find().limit(5).into(new ArrayList<>());\n\n// 6. Return the list of raw BSON documents\nreturn documents;",
				"compile_static":false,
				"captureStdOutput":false
			},
			"skip":false,
			"subTitle":"Code by UnifyApps",
			"title":"Execute Groovy code",
			"type":"ACTION"
		}
	],
	"ownerUserId":39713,
	"schemaReferences":[
		
	],
	"settings":{
		"enableNodeLevelLogging":true,
		"enableRunLogging":true,
		"enableVariableLogging":true,
		"route":{
			"default":false,
			"tierName":"global"
		}
	},
	"standard":false,
	"tags":[
		
	],
	"version":5
}