{
	"appsUsed":[
		
	],
	"createdTime":1747000727658,
	"deleted":false,
	"deploymentState":{
		"deployedAt":1759615033628,
		"deployedBy":1,
		"deployedDefinitionId":"68e198395045f405579af2d7",
		"status":"DEPLOYED",
		"version":89,
		"workflowVersion":152
	},
	"edges":[
		{
			"fromNodeId":"DK3BP",
			"priority":0,
			"skip":false,
			"toNodeId":"Tj7Fm",
			"type":"next"
		},
		{
			"fromNodeId":"Tj7Fm",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"Mpawx",
			"type":"if"
		},
		{
			"fromNodeId":"Mpawx",
			"priority":0,
			"skip":false,
			"toNodeId":"_4XK6R",
			"type":"next"
		},
		{
			"fromNodeId":"Tj7Fm",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"_4XK6R",
			"type":"next"
		},
		{
			"fromNodeId":"_4XK6R",
			"priority":0,
			"skip":false,
			"toNodeId":"CNdYb",
			"type":"next"
		},
		{
			"fromNodeId":"CNdYb",
			"priority":0,
			"skip":false,
			"toNodeId":"ueJdj",
			"type":"next"
		},
		{
			"fromNodeId":"ueJdj",
			"priority":0,
			"skip":false,
			"toNodeId":"GJeE0",
			"type":"next"
		},
		{
			"fromNodeId":"GJeE0",
			"priority":0,
			"skip":false,
			"toNodeId":"Rw0EE",
			"type":"next"
		},
		{
			"fromNodeId":"Rw0EE",
			"priority":0,
			"skip":false,
			"toNodeId":"PZOJQ",
			"type":"next"
		}
	],
	"grants":{
		"configs":[
			{
				"permissions":[
					"V"
				],
				"principalType":"GLOBAL"
			}
		]
	},
	"id":"67f3fb6287fcc53cf63d4938",
	"lastModifiedBy":1,
	"lcName":"fetch few shot examples and instructions",
	"modifiedTime":1759685500056,
	"name":"Fetch Few Shot Examples and Instructions",
	"nodes":[
		{
			"context":{
				"appName":"callables",
				"resourceVersion":182,
				"resourceName":"callables_from_automation"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"WamJg-1",
			"id":"DK3BP",
			"index":1,
			"inputs":{
				"result":{
					"type":"object",
					"properties":{
						"fewShotExamples":{
							"type":"array",
							"items":{
								"type":"object"
							},
							"title":"fewShotExamples"
						},
						"instructions":{
							"type":"string",
							"title":"Instructions"
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"setup":{
					"type":"object",
					"properties":{
						"userQuery":{
							"type":"string",
							"title":"User Query"
						},
						"knowledges":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{
									"id":{
										"type":"string",
										"title":"Id"
									},
									"properties":{
										"type":"object",
										"properties":{},
										"additionalProperties":false,
										"title":"Properties"
									}
								},
								"additionalProperties":false,
								"required":[]
							},
							"title":"Knowledges"
						},
						"aiAgentId":{
							"type":"string",
							"title":"Ai Agent Id"
						}
					},
					"additionalProperties":false,
					"required":[]
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Trigger via automation",
			"trigger":{
				"type":"CALLABLE"
			},
			"type":"START"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":11,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"WamJg-1",
			"id":"Tj7Fm",
			"index":2,
			"inputs":{
				"filters":[
					{
						"property":"=LEN({{ DK3BP.outputs.knowledges }})",
						"filter":{
							"operator":"EQUAL",
							"value":"0"
						}
					},
					{
						"property":"{{ DK3BP.outputs.knowledges[0].id }}",
						"filter":{
							"operator":"MISSING"
						}
					}
				],
				"operator":"OR"
			},
			"skip":false,
			"subTitle":"Condition",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":11,
				"resourceName":"callables_return_to_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"Tj7Fm@WamJg-1@y",
			"id":"Mpawx",
			"index":3,
			"inputs":{
				"result":{}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Respond to automation",
			"type":"STOP"
		},
		{
			"additional":{
				"visibleOptionalFields":[
					"root.parameters.knowledgeIds.items"
				]
			},
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":78,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"WamJg-1",
			"id":"_4XK6R",
			"index":4,
			"inputs":{
				"output":{
					"type":"object",
					"additionalProperties":false,
					"required":[],
					"properties":{
						"filter":{
							"type":"object",
							"properties":{},
							"additionalProperties":false,
							"title":"Filter"
						}
					}
				},
				"input":{
					"type":"object",
					"additionalProperties":false,
					"required":[],
					"properties":{
						"knowledgeIds":{
							"type":"array",
							"items":{
								"type":"string"
							},
							"title":"Knowledge Ids"
						},
						"agentId":{
							"type":"string",
							"title":"Agent Id"
						}
					}
				},
				"code":"// def combinedFilter = [\n//     op: 'AND',\n//     values: []\n// ]\n\n// if(binding.hasVariable('knowledgeIds')) {\n//     def knowledgeFilter = null\n//     knowledgeIds << \"global\"\n//     knowledgeFilter = [\n//         field: 'properties.knowledgeId',\n//         op: 'IN',\n//         values: knowledgeIds\n//     ]    \n//     combinedFilter['values'].add(knowledgeFilter)\n// }\n\n// return ['filter': combinedFilter['values'].size() > 0 ? combinedFilter : null]\n\ndef filters = []\n\n// Knowledge ID filter\nif(binding.hasVariable('knowledgeIds')) {\n    knowledgeIds << \"global\"\n    filters << [\n        field: 'properties.knowledgeId',\n        op: 'IN',\n        values: knowledgeIds\n    ]\n}\n\n// Agent ID filter\nif(binding.hasVariable('agentId')) {\n    filters << [\n        field: 'properties.agentID',\n        op: 'EQUAL',\n        values: [agentId]\n    ]\n}\n\n// Combine with OR if both are present, otherwise just use single\ndef combinedFilter = filters.size() > 1 ?\n    [ op: 'OR', values: filters ] :\n    filters.size() == 1 ?\n        filters[0] : null\n\nreturn ['filter': combinedFilter ?: null]",
				"compile_static":false,
				"isAsync":false,
				"captureStdOutput":false,
				"parameters":{
					"agentId":"{{ DK3BP.outputs.aiAgentId }}",
					"knowledgeIds":{
						"ua:type":"mappedArray",
						"source":"{{ DK3BP.outputs.knowledges }}",
						"items":"{{ DK3BP.outputs.knowledges[0].id }}"
					}
				}
			},
			"options":{
				"businessHoursConfig":{
					"enabled":false,
					"waitForNextWindow":false
				},
				"cacheConfig":{
					"enabled":false
				},
				"circuitBreakerConfig":{
					"enabled":false
				},
				"disableLogging":false,
				"enabledForReExecution":false,
				"hookConfig":{
					"enabled":false
				},
				"logConfig":{
					"enabled":false
				},
				"rateLimitConfig":{
					"enabled":false,
					"waitForNextWindow":false
				},
				"retryConfig":{
					"backOffFactor":null,
					"captureRetries":false,
					"enabled":false
				},
				"stepError":"STOP",
				"telemetryConfig":{
					"enableTelemetry":false
				}
			},
			"skip":false,
			"subTitle":"fetch filter",
			"title":"Execute Groovy code",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":359,
				"resourceName":"callables_call_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"WamJg-1",
			"id":"CNdYb",
			"index":5,
			"inputs":{
				"automationId":"67d5af775c39266befb87be3",
				"runtimeConnections":{},
				"synchronous":true,
				"version":"-1",
				"parameters":{
					"purpose":"AGENTS_embedModel",
					"aiAgentId":"{{ DK3BP.outputs.aiAgentId }}"
				}
			},
			"skip":false,
			"subTitle":"getModelId",
			"title":"Call automation",
			"type":"CALL_WORKFLOW"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":359,
				"resourceName":"callables_call_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"WamJg-1",
			"id":"ueJdj",
			"index":6,
			"inputs":{
				"automationId":"6784b9216fb83f0972c5625d",
				"runtimeConnections":{},
				"synchronous":true,
				"version":"-1",
				"parameters":{
					"userQuery":"{{ DK3BP.outputs.userQuery }}",
					"modelId":"{{ CNdYb.outputs.modelId }}"
				}
			},
			"skip":false,
			"subTitle":"fetchEmbeddings",
			"title":"Call automation",
			"type":"CALL_WORKFLOW"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":359,
				"resourceName":"callables_call_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"CONTINUE",
			"groupId":"WamJg-1",
			"id":"GJeE0",
			"index":7,
			"inputs":{
				"automationId":"68241c2f1db6b1621a5b7934",
				"runtimeConnections":{},
				"synchronous":true,
				"version":"-1",
				"parameters":{
					"embeddings":{
						"source":"{{ ueJdj.outputs.embeddings }}",
						"ua:type":"mappedArray",
						"items":"{{ ueJdj.outputs.embeddings[0] }}"
					},
					"filter":"{{ _4XK6R.outputs.result.filter }}"
				}
			},
			"options":{
				"businessHoursConfig":{
					"enabled":false,
					"waitForNextWindow":false
				},
				"cacheConfig":{
					"enabled":false,
					"usagePolicy":"ALWAYS"
				},
				"circuitBreakerConfig":{
					"enabled":false,
					"slidingWindowType":"COUNT_BASED"
				},
				"disableLogging":false,
				"enabledForReExecution":false,
				"hookConfig":{
					"enabled":false,
					"postHooks":[
						
					],
					"preHooks":[
						
					]
				},
				"logConfig":{
					"enabled":false,
					"logPolicies":[
						
					]
				},
				"rateLimitConfig":{
					"enabled":false,
					"unit":"MINUTES",
					"waitForNextWindow":false
				},
				"retryConfig":{
					"backOffFactor":null,
					"captureRetries":false,
					"enabled":false
				},
				"stepError":"CONTINUE",
				"telemetryConfig":{
					"enableTelemetry":false,
					"metricConfigs":[
						
					]
				}
			},
			"skip":false,
			"subTitle":"Query Fetcher",
			"title":"Call automation",
			"type":"CALL_WORKFLOW"
		},
		{
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":185,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"WamJg-1",
			"id":"Rw0EE",
			"index":8,
			"inputs":{
				"output":{
					"type":"object",
					"properties":{
						"fewShot":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{},
								"additionalProperties":false
							},
							"title":"fewShot"
						},
						"combinedKnowledgeInstructionsForPrompt":{
							"type":"string",
							"title":"combinedKnowledgeInstructionsForPrompt"
						}
					},
					"additionalProperties":false,
					"required":[
						"fewShot",
						"combinedKnowledgeInstructionsForPrompt"
					]
				},
				"input":{
					"type":"object",
					"properties":{
						"knowledgeRawData":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{},
								"additionalProperties":false
							},
							"title":"knowledgeRawData"
						},
						"fewShotRawData":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{},
								"additionalProperties":false
							},
							"title":"fewShotRawData"
						}
					},
					"additionalProperties":false,
					"required":[
						"knowledgeRawData",
						"fewShotRawData"
					]
				},
				"compile_static":true,
				"code":"static Map<String, Object> safeMap(Object obj) {\n    return (obj instanceof Map) ? (Map<String, Object>) obj : Collections.emptyMap()\n}\n\nList<Map<String, Object>> fewShot = []\n\nif (binding.hasVariable(\"fewShotRawData\")) {\n    List<Object> fewShotRawData = (List<Object>) binding.getVariable(\"fewShotRawData\")\n    for (Object item : fewShotRawData) {\n        Map<String, Object> data = safeMap(item)\n        Map<String, Object> document = safeMap(data[\"document\"])\n        Map<String, Object> properties = safeMap(document[\"properties\"])\n\n        fewShot.add([\n            userQuery : properties[\"query\"],\n            jsonOutput: properties[\"output\"]\n        ])\n    }\n}\n\nString combinedKnowledgeInstructionsForPrompt = \"\"\n\nif (binding.hasVariable(\"knowledgeRawData\")) {\n    List<Object> knowledgeRawData = (List<Object>) binding.getVariable(\"knowledgeRawData\")\n    for (Object item : knowledgeRawData) {\n        Map<String, Object> data = safeMap(item)\n        Map<String, Object> properties = safeMap(data[\"properties\"])\n        Map<String, Object> additionalDetails = safeMap(properties[\"additionalDetails\"])\n        String instruction = additionalDetails[\"knowledgeInstructionsForPrompt\"] != null ? additionalDetails[\"knowledgeInstructionsForPrompt\"].toString() : \"\"\n        combinedKnowledgeInstructionsForPrompt += instruction + \"\\n\"\n    }\n}\n\nMap<String, Object> result = [\n    fewShot: fewShot,\n    combinedKnowledgeInstructionsForPrompt: combinedKnowledgeInstructionsForPrompt.trim()\n]\n\nreturn result\n",
				"parameters":{
					"fewShotRawData":{
						"ua:type":"mappedArray",
						"source":"{{ GJeE0.outputs.data }}",
						"items":"{{ GJeE0.outputs.data[0] }}"
					},
					"knowledgeRawData":{
						"ua:type":"mappedArray",
						"source":"{{ DK3BP.outputs.knowledges }}",
						"items":"{{ DK3BP.outputs.knowledges[0] }}"
					}
				}
			},
			"skip":false,
			"subTitle":"Parse Objects",
			"title":"Execute Groovy code",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":185,
				"resourceName":"callables_return_to_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"WamJg-1",
			"id":"PZOJQ",
			"index":9,
			"inputs":{
				"result":{
					"instructions":"{{ Rw0EE.outputs.result.combinedKnowledgeInstructionsForPrompt }}",
					"fewShotExamples":{
						"source":"{{ Rw0EE.outputs.result.fewShot }}",
						"ua:type":"mappedArray",
						"items":"{{ Rw0EE.outputs.result.fewShot[0] }}"
					}
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Respond to automation",
			"type":"STOP"
		}
	],
	"ownerUserId":1,
	"schemaReferences":[
		
	],
	"settings":{
		"enableNodeLevelLogging":true,
		"enableRunLogging":true,
		"enableVariableLogging":true,
		"route":{
			"default":false,
			"tierName":"global"
		}
	},
	"standard":true,
	"tags":[
		"AI Agent"
	],
	"version":153
}